---
- name: configure dns for forgejo
  cloudflare_dns:
    api_token: "{{ CLOUDFLARE_API_TOKEN }}"
    zone: coherence.space
    type: CNAME
    record: git
    value: "{{ inventory_hostname }}"

- name: install forgejo
  pacman: name=forgejo state=present

- name: copy forgejo config file
  template: src=app.ini.j2 dest=/etc/forgejo/app.ini mode=0644 owner=forgejo group=forgejo
  notify: restart forgejo

- name: start and enable forgejo
  service: name=forgejo.service enabled=yes state=started

- name: add caddy config
  template: src=gitea.caddy.j2 dest=/etc/caddy/conf.d/gitea.caddy mode=0644
  notify: reload caddy
